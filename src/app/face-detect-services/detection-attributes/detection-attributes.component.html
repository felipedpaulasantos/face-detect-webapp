<mat-card [style.height.px]="innerHeight" class="overflow-auto">

  {{ photoDimensions | json }}

  <mat-form-field *ngIf="detectionAttributesArray && detectionAttributesArray.length > 1">
    <mat-label>Faces detectadas</mat-label>
    <mat-select (selectionChange)="updateDetectionAttributes($event)">
      <mat-option *ngFor="let attr of detectionAttributesArray" [value]="detectionAttributesArray.indexOf(attr)">
        {{attr.faceId}}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-tab-group *ngIf="detectionAttributes else noAttributes" #tabGroup (selectedTabChange)="drawFaceRectangle($event)" mat-stretch-tabs>

    <mat-tab label="Atributos">

      <ul>
        <li>
          <span class="font-weight-bold mr-2">ID: </span>
          {{ detectionAttributes.faceId }}
        </li>
      </ul>

      <button mat-icon-button (click)="toggleTreeExpanded()">
        <mat-icon class="mat-icon-rtl-mirror">
          {{isTreeExpanded ? 'expand_more' : 'chevron_right'}}
        </mat-icon>
      </button>

      <mat-tree  #tree [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">
        <!-- This is the tree node template for leaf nodes -->
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
          <li class="mat-tree-node">
            <!-- use a disabled button to provide padding for tree leaf -->
            <button mat-icon-button disabled></button>
            <ng-container *ngIf="node.value else noValue">

              <span class="font-weight-bold mr-2">
                {{node.name}}:
              </span>
              <ng-container *ngIf="node.type && node.type == 'number'">
                {{node.value | number}}
              </ng-container>

              <ng-container *ngIf="node.type && node.type == 'date'">
                {{node.value | date}}
              </ng-container>

              <ng-container *ngIf="node.type && node.type == 'percent'">
                {{node.value | percent}}
              </ng-container>

              <ng-container *ngIf="node.value == 'male'">
                <i class="fas fa-2x fa-mars text-primary"></i>
              </ng-container>

              <ng-container *ngIf="node.value == 'female'">
                <i class="fas fa-2x fa-venus text-danger"></i>
              </ng-container>

              <ng-container *ngIf="node.type == 'boolean' && node.value == 'true'">
                <mat-icon class="text-success">check</mat-icon>
              </ng-container>

              <ng-container *ngIf="node.type == 'boolean' && node.value == 'false'">
                <mat-icon class="text-danger">close</mat-icon>
              </ng-container>

              <ng-container *ngIf="node.type == 'color'">
                <mat-icon [ngStyle]="{'color': node.name == 'blond' ? '#faf0be' : node.name}" class="mr-2">lens</mat-icon>
                {{ node.value | percent }}
              </ng-container>

              <ng-container *ngIf="!node.type">
                {{node.value}}
              </ng-container>

            </ng-container>

            <ng-template #noValue>
              {{node.name}}
            </ng-template>
          </li>
        </mat-tree-node>
        <!-- This is the tree node template for expandable nodes -->
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
          <li>
            <div class="mat-tree-node">
              <button mat-icon-button matTreeNodeToggle
                      [attr.aria-label]="'toggle ' + node.name">
                <mat-icon class="mat-icon-rtl-mirror">
                  {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
                </mat-icon>
              </button>
              <ng-container *ngIf="node.value else noChildValue">
                {{node.name}}: {{node.value}}
              </ng-container>
              <ng-template #noChildValue>
                {{node.name}}
              </ng-template>
            </div>
            <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
              <ng-container matTreeNodeOutlet></ng-container>
            </ul>
          </li>
        </mat-nested-tree-node>
      </mat-tree>
    </mat-tab>


    <mat-tab *ngIf="detectionAttributes && detectionAttributes.faceRectangle" label="Localização">
      <ul class="list-unstyled" *ngFor="let item of detectionAttributes.faceRectangle | keyvalue:keepOriginalOrder">
        <li>
          <span class="font-weight-bold mr-2">{{ item.key }}: </span>
          {{ item.value | number }}
        </li>
      </ul>
    </mat-tab>


    <mat-tab *ngIf="detectionAttributes && detectionAttributes.faceLandmarks" label="Pontos de referência">
      <ul class="list-unstyled" *ngFor="let item of detectionAttributes.faceLandmarks | keyvalue:keepOriginalOrder">
        <li>
          <span>{{ item.key }}: </span>
          <span *ngFor="let item of item.value | keyvalue">
            <br>
            <button mat-icon-button disabled></button>
            <span class="font-weight-bold mr-2">{{ item.key }}:</span> {{ item.value | number }}
          </span>
        </li>
      </ul>
    </mat-tab>


  </mat-tab-group>
  <ng-template #noAttributes>
    <div class="h-100 d-flex align-items-center justify-content-center">
      <h1 class="text-muted">Consulte uma imagem para verificar seus atributos.</h1>
    </div>
  </ng-template>

</mat-card>
